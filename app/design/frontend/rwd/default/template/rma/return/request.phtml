<?php
/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
?>
<div class="page-title">
    <h1><?php echo $this->__('Create New RMA') ?></h1>
</div>
<form id="requestForm" method="POST" action="<?php echo Mage::getUrl('rma/index/save'); ?>">
<label><h4>Order Id : </h4></label>
<?php $orderInfo = $this->getOrders();
    if(count($orderInfo)>0) : ?>
<select name="order" id="selectOrder" class="validate-select">
    <option value="">-- Select Orders --</option>
    <?php foreach($orderInfo as $_order): 
    if($_order['status'] == 'complete'):?>
    <option value="<?php echo $_order->getId() ?>">
    <?php echo $_order->getIncrementId()?>
    </option>
    <?php endif;?>
    <?php endforeach; ?>
    </select>
<?php endif; ?>
    <table class="data-table orders" id="my-rma-table" >
    <col width="1" />
    <col width="1" />
    <col width="1" />
    <col width="1" />
    <col width="1" />
    <thead>
        <tr>
            <th class="view"><?php echo $this->__('ACTION'); ?></th>
            <th class="number"><?php echo $this->__('PRODUCT NAME') ?></th>
            <th class=""><?php echo $this->__('SKU') ?></th>
            <th class="number"><?php echo $this->__('QUANTITY') ?></th>
            <th class="total"><span class="nobr"><?php echo $this->__('PRICE') ?></span></th>
            
        </tr>
    </thead>
     
    <tbody id="results">
            
    </tbody>
    <tr>
            <td><label>Resolution</label></td>
            <td>
                <?php                 
                $resolution=Mage::helper('rma')->getAttributeOptionValues('resolution');                
                ?>               
                <select name="resolution_type" class="validate-select">
                    <option value="">-- Select Resolution --</option>
                    <?php foreach ($resolution as $key => $value) {?>        
                    <option value="<?php echo $key;?>"><?php echo $value;?></option>
                   <?php
                    }?>
                </select>
            </td>
        </tr>
        <tr>
            <td><label>Reason</label></td>
            <td><input type="text" name="reason" class="required-entry"></td>
        </tr>
        <tr>
            <td><label>Condition</label></td>
            <td>
              <?php                 
                $condition=Mage::helper('rma')->getAttributeOptionValues('condition');                
                ?>               
                <select name="condition"  class="validate-select">
                    <option value="">-- Select condition --</option>
                    <?php foreach ($condition as $key => $value) {?>        
                    <option value="<?php echo $key;?>"><?php echo $value;?></option>
                   <?php
                    }?>
                </select>               
            </td>
        </tr>        
        <tr>
            <td>
                <input type="submit" id="submit">
            </td>
        </tr>
        
    </table>
    
</form>

<script type="text/javascript">
    //<![CDATA[  
    
    var $j = jQuery.noConflict();
    $j("#selectOrder").change( function() {
    var selectedOption = $j("#selectOrder option:selected");
    var selectedValue = selectedOption.val();
    if(selectedValue!=0)
    {
        
    $j('#advice-validate-select-selectOrder').hide();
    $j.ajax({
            type: "POST",
            url: "<?php echo $this->getUrl('rma/index/productinfo')?>",
            data: {OrderId:selectedValue},
            success: function(response) {
                if(response)
                {
                    $j('#results').empty();
                    $j('#results').append(response);                    
                }
                else
                {
                    $j('#results').append('Product cannot be return');
                }
                   
            },
            error: function() {
                alert("error");
            }
        });
    }
    });       
    $j('#submit').click(function(){        
        cnt=$j('#cnt').val();  
        ncnt=cnt-1;     
        for (i = 0; i < cnt; i++) {
            var checkedval=$j('#checkbox_product_'+i).val();            
             var selectedQtyById=$j('#productQty_'+i).val();
              var orderedQty = $j('#qty_ordered_'+i).val();            
              var product_name=$j("#product_name_"+i).val();              
              
             if(selectedQtyById > orderedQty)
          {   
            $j("#notification-message").show();
            $j("#notification").empty();
            $j("#notification").append("You can not return more than "+orderedQty+" "+product_name);
          }
           }
    });
    var customForm = new VarienForm('requestForm'); 
    //]]>
</script>